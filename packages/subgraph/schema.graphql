type Issuer @entity {
  id: ID!
  address: Bytes!
  tokensIssued: Int!
  tokens: [LiquidRestakingToken!] @derivedFrom(field: "issuer")
}

type Coordinator @entity {
  id: ID!
  address: Bytes!
  restakingToken: LiquidRestakingToken!
}

type LiquidRestakingToken @entity {
  id: ID!

  address: Bytes!
  symbol: String!
  name: String!

  createdTimestamp: Int!
  totalSupply: BigDecimal!
  totalValueETH: BigDecimal
  totalValueUSD: BigDecimal
  percentAPY: BigDecimal # APY based on a 14-day moving average.

  issuer: Issuer!
  coordinator: Coordinator!

  underlyingAssets: [UnderlyingAsset!] @derivedFrom(field: "restakingToken")
}

type User @entity {
  id: ID!
  address: Bytes!
  balance: BigDecimal! # TODO: This doesn't work for multiple LRTs
  deposits: [Deposit!] @derivedFrom(field: "user")
  withdrawals: [Withdrawal!] @derivedFrom(field: "user")
}

type Deposit @entity(immutable: true) {
  id: ID!
  user: User!
  sender: Bytes!
  assetIn: Asset!
  amountIn: BigDecimal!
  amountOut: BigDecimal!
  restakingToken: LiquidRestakingToken!
  userBalanceBefore: BigDecimal!
  userBalanceAfter: BigDecimal!
  valueUSD: BigDecimal
  timestamp: BigInt!
  blockNumber: BigInt!
  tx: Bytes!
}

type Withdrawal @entity {
  id: ID!
  user: User!
  sender: Bytes!
  assetOut: Asset!
  sharesOwed: BigDecimal!
  amountIn: BigDecimal!
  restakingToken: LiquidRestakingToken!
  userBalanceBefore: BigDecimal!
  userBalanceAfter: BigDecimal!
  valueUSD: BigDecimal
  timestamp: BigInt!
  blockNumber: BigInt!
  requestTx: Bytes!

  isReadyToClaim: Boolean!
  isClaimed: Boolean!
  amountOut: BigDecimal # The exact output amount is unknown prior to epoch settlement.
  claimTx: Bytes
}

type UnderlyingAsset @entity {
  id: ID!
  address: Bytes!
  restakingToken: LiquidRestakingToken!
  asset: Asset!
  strategy: Bytes!
  depositCap: BigDecimal!
  priceFeed: Bytes!

  balance: BigDecimal!
  balanceInDepositPool: BigDecimal!
  balanceInEigenLayer: BigDecimal!
}

type Asset @entity {
  id: ID!
  symbol: String!
  name: String!
  decimals: Int!
  address: Bytes!
  latestUSDPrice: BigDecimal # Latest price of asset in USD, updated on deposit/withdrawal.
  latestUSDPriceTimestamp: BigInt # Timestamp at which the `latestUSDPrice` was updated.
}
